## **BIOS
### 1. **BIOS的作用和存放位置**

- **作用**：BIOS（Basic Input/Output System）是计算机加电后运行的第一段程序，负责**硬件的自检和初始化**，以及后续操作系统引导的准备工作。
- **存放位置**：BIOS固化在**主板上的ROM芯片**里。ROM（只读存储器）断电后数据不会丢失，非常适合存储“启动时必须有”的程序代码。

---

### 2. **BIOS的入口和实模式寻址**

- **入口地址**：CPU复位后，会自动跳到物理地址`0xFFFF0`处执行BIOS（其实这只是BIOS映像的末尾，实际只放一个跳转指令）。
- **CS:IP寻址机制**：实模式下，CS:IP（代码段:指令指针）组合起来可以寻址20位物理地址，即`(CS << 4) + IP`。例如启动时CS=0xF000, IP=0xFFF0，最终地址就是`0xFFFF0`。
- **跳转原理**：`0xFFFF0`只存了一个“跳转指令”，实际BIOS代码在别处，比如`0xFE05B`。

---

### 3. **BIOS初始化及中断向量表**

- BIOS会对**内存、显卡、键盘等外设做自检**和初始化，还要给后续系统引导做准备。
- BIOS最重要的工作之一：**建立中断向量表（Interrupt Vector Table, IVT）**。
    - 位置：实模式下，**中断向量表位于内存0x0000 ~ 0x03FF**（即前1KB空间）。
    - 作用：存放256个中断类型（0~255，每个4字节），每个中断的入口地址，也就是“向量”。
    - 这样，CPU遇到`int xx`指令（如`int 0x80`），就能从IVT查到处理该中断的函数地址，快速跳转过去执行对应服务。

---

### 4. **BIOS到MBR的流程梳理**

- BIOS初始化硬件
- 建立中断向量表
- 加载并跳转到**MBR（主引导记录）**，为操作系统启动做准备

---
## **BIOS的最后一项任务**

- **检测磁盘**：BIOS会去检查“0盘0道1扇区”（即第一个硬盘的第一个柱面、第一扇区）内容。
- **历史原因**：扇区编号从1开始，所以“1扇区”其实是第一个扇区，不用纠结。

## 2. **MBR的“魔数”检测**

- **魔数**：BIOS会检查这个扇区最后两个字节（第511字节和第512字节）。
    - 必须分别为`0x55`和`0xAA`（小端序存储，其实在内存中是`0xAA55`）。
- **作用**：这是一种“标记”，告诉BIOS“这是一个有效的启动扇区（可引导扇区）”。

## 3. **MBR的加载位置和执行**

- **加载位置**：如果检测到魔数，BIOS会把整个512字节的MBR代码加载到**内存的物理地址0x7C00**处。
- **跳转执行**：接着CPU会跳转到0x7C00，开始执行MBR里的引导程序（这也是我们写自制操作系统时第一个能“跑起来”的自己的代码）。

## 4. **MBR相关规定**

- **大小**：MBR固定为**512字节**。
- **末尾魔数**：第511字节和第512字节必须是`0xAA`、`0x55`（用小端序存储，实际为`0x55AA`）。
- **内容**：前446字节通常存放引导程序代码，接着64字节是分区表，最后2字节是魔数。
- **小端序**：因为x86平台是小端序，所以存储顺序是低字节在前（即`0x55`，再是`0xAA`）。

![[image.png]]![[Pasted image 20250828145854.png]]

## 保护模式入门
开机时，32 位的 CPU 是先处于实模式，之后再进入保护模式的
寄存器中低 16 位的部分是为了兼容实模式，可以单独使用。高 16 位没办法单独使用，只能在用 32 位寄存器时才有机会用到它们。

---

### 全局描述符表 (Global Descriptor Table, GDT)

- **本质**: 全局描述符表是一个储存在内存中的“表”，它由一系列被称为 **段描述符** 的表项组成。
    
- **表项 (段描述符)**: 表中的每一个条目都称为一个段描述符，其大小为 **64 字节**。每个段描述符都用来详细描述一个内存段，包括它的**起始地址**、**大小**和**访问权限**等信息。
    
- **存放位置与引用**: 由于该表可能非常大，因此它被存放在内存中。处理器使用 **GDTR 寄存器** 来指向该表的起始位置，从而能够找到并访问它。
    

简而言之，全局描述符表就像一个目录，列出了所有可用的内存段，而 GDTR 寄存器则像一个指针，指向这个目录的起点，让处理器可以快速找到它。